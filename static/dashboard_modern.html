<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SableCore Dashboard - Modern AI Control Center</title>
    
    <!-- React & ReactDOM from CDN -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Chart.js for visualizations -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        
        body {
            font-family: 'Inter', sans-serif;
            margin: 0;
            padding: 0;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        
        .glass {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .glow {
            box-shadow: 0 0 20px rgba(124, 58, 237, 0.5);
        }
        
        .chat-scroll {
            scrollbar-width: thin;
            scrollbar-color: rgba(124, 58, 237, 0.5) transparent;
        }
        
        .chat-scroll::-webkit-scrollbar {
            width: 6px;
        }
        
        .chat-scroll::-webkit-scrollbar-thumb {
            background: rgba(124, 58, 237, 0.5);
            border-radius: 3px;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // Main Dashboard Component
        function Dashboard() {
            const [activeTab, setActiveTab] = useState('chat');
            const [messages, setMessages] = useState([]);
            const [input, setInput] = useState('');
            const [stats, setStats] = useState({
                messages: 0,
                uptime: '0h 0m',
                memory: '0 MB',
                skills: 0
            });
            const [skills, setSkills] = useState([]);
            const [isConnected, setIsConnected] = useState(false);

            useEffect(() => {
                // Fetch initial data
                fetchStats();
                fetchSkills();
                connectWebSocket();
                
                // Update stats every 5 seconds
                const interval = setInterval(fetchStats, 5000);
                return () => clearInterval(interval);
            }, []);

            const fetchStats = async () => {
                try {
                    const response = await fetch('/api/stats');
                    const data = await response.json();
                    setStats(data);
                } catch (error) {
                    console.error('Failed to fetch stats:', error);
                }
            };

            const fetchSkills = async () => {
                try {
                    const response = await fetch('/api/skills');
                    const data = await response.json();
                    setSkills(data.skills || []);
                } catch (error) {
                    console.error('Failed to fetch skills:', error);
                }
            };

            const connectWebSocket = () => {
                const ws = new WebSocket(`ws://${window.location.host}/ws`);
                
                ws.onopen = () => setIsConnected(true);
                ws.onclose = () => setIsConnected(false);
                
                ws.onmessage = (event) => {
                    const message = JSON.parse(event.data);
                    setMessages(prev => [...prev, message]);
                };
            };

            const sendMessage = async (e) => {
                e.preventDefault();
                if (!input.trim()) return;

                const userMessage = {
                    role: 'user',
                    content: input,
                    timestamp: new Date().toISOString()
                };

                setMessages(prev => [...prev, userMessage]);
                setInput('');

                try {
                    const response = await fetch('/api/chat', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ message: input })
                    });

                    const data = await response.json();
                    
                    const botMessage = {
                        role: 'assistant',
                        content: data.response,
                        timestamp: new Date().toISOString()
                    };

                    setMessages(prev => [...prev, botMessage]);
                } catch (error) {
                    console.error('Failed to send message:', error);
                }
            };

            return (
                <div className="min-h-screen p-6">
                    {/* Header */}
                    <header className="glass rounded-2xl p-6 mb-6 glow">
                        <div className="flex items-center justify-between">
                            <div className="flex items-center space-x-4">
                                <div className="w-12 h-12 bg-gradient-to-br from-purple-500 to-pink-500 rounded-xl flex items-center justify-center">
                                    <span className="text-2xl">ü§ñ</span>
                                </div>
                                <div>
                                    <h1 className="text-3xl font-bold text-white">SableCore Dashboard</h1>
                                    <p className="text-purple-200">Advanced AI Control Center</p>
                                </div>
                            </div>
                            <div className="flex items-center space-x-4">
                                <div className={`px-4 py-2 rounded-lg ${isConnected ? 'bg-green-500' : 'bg-red-500'}`}>
                                    <span className="text-white font-medium">
                                        {isConnected ? 'üü¢ Connected' : 'üî¥ Disconnected'}
                                    </span>
                                </div>
                            </div>
                        </div>
                    </header>

                    {/* Stats Grid */}
                    <div className="grid grid-cols-1 md:grid-cols-4 gap-6 mb-6">
                        <StatCard icon="üí¨" label="Messages" value={stats.messages} />
                        <StatCard icon="‚è±Ô∏è" label="Uptime" value={stats.uptime} />
                        <StatCard icon="üß†" label="Memory" value={stats.memory} />
                        <StatCard icon="üõ†Ô∏è" label="Skills" value={stats.skills} />
                    </div>

                    {/* Main Content */}
                    <div className="grid grid-cols-1 lg:grid-cols-3 gap-6">
                        {/* Chat Panel */}
                        <div className="lg:col-span-2">
                            <div className="glass rounded-2xl p-6 h-[600px] flex flex-col">
                                <div className="flex items-center justify-between mb-4">
                                    <h2 className="text-2xl font-bold text-white">üí¨ Chat</h2>
                                    <button 
                                        onClick={() => setMessages([])}
                                        className="px-4 py-2 bg-red-500 hover:bg-red-600 rounded-lg text-white transition"
                                    >
                                        Clear
                                    </button>
                                </div>
                                
                                <ChatMessages messages={messages} />
                                
                                <form onSubmit={sendMessage} className="mt-4">
                                    <div className="flex space-x-2">
                                        <input
                                            type="text"
                                            value={input}
                                            onChange={(e) => setInput(e.target.value)}
                                            placeholder="Type your message..."
                                            className="flex-1 px-4 py-3 rounded-lg bg-white/10 text-white placeholder-purple-200 border border-white/20 focus:outline-none focus:border-purple-400"
                                        />
                                        <button
                                            type="submit"
                                            className="px-6 py-3 bg-gradient-to-r from-purple-500 to-pink-500 hover:from-purple-600 hover:to-pink-600 rounded-lg text-white font-medium transition"
                                        >
                                            Send
                                        </button>
                                    </div>
                                </form>
                            </div>
                        </div>

                        {/* Skills Panel */}
                        <div className="glass rounded-2xl p-6">
                            <h2 className="text-2xl font-bold text-white mb-4">üõ†Ô∏è Skills Hub</h2>
                            <SkillsList skills={skills} />
                        </div>
                    </div>
                </div>
            );
        }

        // Stat Card Component
        function StatCard({ icon, label, value }) {
            return (
                <div className="glass rounded-2xl p-6 hover:glow transition">
                    <div className="flex items-center justify-between">
                        <div>
                            <p className="text-purple-200 text-sm mb-1">{label}</p>
                            <p className="text-3xl font-bold text-white">{value}</p>
                        </div>
                        <div className="text-4xl">{icon}</div>
                    </div>
                </div>
            );
        }

        // Chat Messages Component
        function ChatMessages({ messages }) {
            const messagesEndRef = useRef(null);

            useEffect(() => {
                messagesEndRef.current?.scrollIntoView({ behavior: 'smooth' });
            }, [messages]);

            return (
                <div className="flex-1 overflow-y-auto chat-scroll space-y-4">
                    {messages.length === 0 ? (
                        <div className="h-full flex items-center justify-center">
                            <p className="text-purple-200 text-lg">No messages yet. Start a conversation!</p>
                        </div>
                    ) : (
                        messages.map((msg, idx) => (
                            <div key={idx} className={`flex ${msg.role === 'user' ? 'justify-end' : 'justify-start'}`}>
                                <div className={`max-w-[70%] px-4 py-3 rounded-2xl ${
                                    msg.role === 'user' 
                                        ? 'bg-gradient-to-r from-purple-500 to-pink-500 text-white' 
                                        : 'bg-white/10 text-white border border-white/20'
                                }`}>
                                    <p className="whitespace-pre-wrap">{msg.content}</p>
                                    <p className="text-xs mt-1 opacity-70">
                                        {new Date(msg.timestamp).toLocaleTimeString()}
                                    </p>
                                </div>
                            </div>
                        ))
                    )}
                    <div ref={messagesEndRef} />
                </div>
            );
        }

        // Skills List Component
        function SkillsList({ skills }) {
            return (
                <div className="space-y-3 overflow-y-auto max-h-[500px] chat-scroll">
                    {skills.length === 0 ? (
                        <p className="text-purple-200">No skills installed yet.</p>
                    ) : (
                        skills.map((skill, idx) => (
                            <div key={idx} className="bg-white/10 rounded-lg p-4 border border-white/20 hover:border-purple-400 transition">
                                <div className="flex items-center justify-between mb-2">
                                    <h3 className="font-semibold text-white">{skill.name}</h3>
                                    <span className="px-2 py-1 bg-purple-500 rounded text-xs text-white">
                                        v{skill.version}
                                    </span>
                                </div>
                                <p className="text-sm text-purple-200">{skill.description}</p>
                                <div className="mt-2 flex items-center space-x-2 text-xs text-purple-300">
                                    <span>‚≠ê {skill.rating}/5</span>
                                    <span>‚Ä¢</span>
                                    <span>üì• {skill.downloads}</span>
                                </div>
                            </div>
                        ))
                    )}
                </div>
            );
        }

        // Render the app
        ReactDOM.render(<Dashboard />, document.getElementById('root'));
    </script>
</body>
</html>
